<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Email Rewriter</title>
  <style>
    body { font-family: sans-serif; margin: 2rem; }
    textarea, select, button { width: 100%; margin-top: 1rem; font-size: 1rem; }
    #output { margin-top: 2rem; white-space: pre-wrap; background: #f9f9f9; padding: 1rem; }
  </style>
</head>
<body>
  <h1>Email Rewriter âœ¨</h1>
  
  <label for="email">Your Email:</label>
  <textarea id="email" rows="6" placeholder="Paste your rough email here..."></textarea>

  <label for="tone">Choose a tone:</label>
  <select id="tone">
    <option value="friendly">Friendly</option>
    <option value="professional">Professional</option>
    <option value="concise">Concise</option>
    <option value="very angry">Very Angry ğŸ˜¡</option>
    <option value="ultra formal">Ultra Formal ğŸ§</option>
    <option value="casual and lazy">Casual and Lazy ğŸ˜´</option>
    <option value="pirate">Pirate ğŸ´â€â˜ ï¸</option>
    <option value="motivational speaker">Motivational Speaker ğŸ¤</option>
    <option value="passive aggressive">Passive Aggressive ğŸ˜‡ğŸ”ª</option>
  </select>

  <button onclick="rewriteEmail()">Rewrite It</button>

  <div id="output"></div>
  <hr>
<h2>ğŸ” Prompt Review</h2>
<button onclick="suggestPrompt()">Review History & Suggest Prompt</button>
<pre id="suggestedPrompt" style="white-space: pre-wrap; margin-top: 1rem;"></pre>


  <script>
    async function rewriteEmail() {
      const email = document.getElementById('email').value;
      const tone = document.getElementById('tone').value;

      const response = await fetch('http://127.0.0.1:8000/rewrite', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, tone })
      });

      const data = await response.json();
      document.getElementById('output').innerText = data.rewritten || data.error || 'No response';
    }

    async function suggestPrompt() {
  const history = await fetch('http://127.0.0.1:8000/history').then(res => res.json());

  const prompt = `
You are a senior prompt engineer reviewing the performance of an AI assistant that rewrites emails using tone guidance.
Based on the following data (original email, tone, AI response), suggest an improved system prompt or instruction set.
Be concise and opinionated. Return only the new proposed system prompt.

DATA:
${JSON.stringify(history.slice(-10), null, 2)}
`;

  const response = await fetch('http://127.0.0.1:8000/analyse_prompt', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ prompt })
  });

  const data = await response.json();
  document.getElementById('suggestedPrompt').innerText = data.output || data.error || 'No response';
}
  </script>
</body>
</html>
